

import React, { createContext, useContext, useState, useEffect, useCallback } from 'react';
import useLocalStorage from './hooks/useLocalStorage';

// --- THEME CONTEXT ---
type Theme = 'light' | 'dark';

interface ThemeContextType {
  theme: Theme;
  toggleTheme: () => void;
}

const ThemeContext = createContext<ThemeContextType | undefined>(undefined);

export const ThemeProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const theme: Theme = 'light';

  useEffect(() => {
    const root = window.document.documentElement;
    root.classList.remove('dark');
    root.classList.add('light');
  }, []);

  const toggleTheme = () => {
    // No-op. Dark mode is removed.
  };

  return (
    <ThemeContext.Provider value={{ theme, toggleTheme }}>
      {children}
    </ThemeContext.Provider>
  );
};

export const useTheme = () => {
  const context = useContext(ThemeContext);
  if (context === undefined) {
    throw new Error('useTheme must be used within a ThemeProvider');
  }
  return context;
};

// --- LANGUAGE CONTEXT ---
type Language = 'en' | 'vi';

interface LanguageContextType {
  language: Language;
  setLanguage: (lang: Language) => void;
  t: (key: keyof typeof translations['en'], ...args: (string | number)[]) => string;
}

const translations = {
  en: {
    headerTitle: "MemoryCare",
    navHome: "Home",
    navMemoryLog: "Memory Log",
    navPlanner: "Planner",
    navLocation: "Location",
    navMyStory: "My Story",
    navSettings: "Settings",
    footerText: "MemoryCare Â© {year}",
    language: "Language",
    welcomeTitle: "Today's Dashboard",
    welcomeSubtitle: "Here's a summary of your day.",
    welcomeMessage: "This application is designed to help you manage your day, remember important information, and stay connected.",
    todaysSchedule: "Today's Schedule",
    noActivitiesToday: "No activities for today. Ready to plan?",
    goToPlanner: "Go to Planner",
    familiarFace: "A Familiar Face",
    noPeopleToAdd: "No one's here yet. Add a loved one.",
    goToMemoryLog: "Go to Memory Log",
    quickActions: "Quick Actions",
    featureMemoryLogTitle: "Memory Log",
    featureMemoryLogDesc: "Keep track of loved ones and daily thoughts.",
    featurePlannerTitle: "Activity Planner",
    featurePlannerDesc: "Schedule your daily activities with reminders.",
    featureLocationTitle: "Location Services",
    featureLocationDesc: "Get help with navigation and stay safe.",
    reminderTitle: "A Gentle Reminder",
    reminderText: "Take each day one step at a time. We are here to support you. If you need help, please reach out to a caregiver or family member.",
    pageTitleMemoryLog: "Memory Log",
    pageSubtitleMemoryLog: "Remember important people and record your daily thoughts.",
    personAddedSuccess: "{name} added successfully!",
    personUpdatedSuccess: "{name} updated successfully.",
    personDeletedInfo: "Person deleted.",
    confirmDeletePerson: "Are you sure you want to delete this person?",
    journalSavedSuccess: "Journal entry saved!",
    journalNoSpeechInfo: "No speech detected to save.",
    confirmDeleteJournal: "Are you sure you want to delete this journal entry?",
    journalDeletedInfo: "Journal entry deleted.",
    ttsNotSupportedError: "Text-to-speech is not supported on this device.",
    ttsLanguageUnavailableError: "A native voice for the selected language is not available on your device. Speech functionality is limited.",
    peopleSectionTitle: "People",
    addPersonButton: "Add Person",
    noPeopleYet: 'No people added yet. Click "Add Person" to get started.',
    recallButton: "Recall",
    editButton: "Edit",
    deleteButton: "Delete",
    personRecallSpeech: "This is {name}, who is your {relationship}. {keyInfo}",
    journalSectionTitle: "Daily Journal",
    journalDescription: "Record your thoughts, feelings, or activities for the day using your voice.",
    speechNotSupported: "Speech recognition is not supported in your browser.",
    listeningPlaceholder: "Listening...",
    recordedThoughtsPlaceholder: "Your recorded thoughts will appear here...",
    startRecordingButton: "Start Recording",
    stopRecordingButton: "Stop Recording",
    saveEntryButton: "Save Entry",
    pastEntriesTitle: "Past Entries:",
    readAloudButton: "Read Aloud",
    modalAddPersonTitle: "Add New Person",
    modalEditPersonTitle: "Edit {name}",
    formNameLabel: "Name",
    formRelationshipLabel: "Relationship",
    formPhotoUrlLabel: "Photo URL or Upload",
    formKeyInfoLabel: "Key Information",
    formCancelButton: "Cancel",
    formAddButton: "Add Person",
    formUpdateButton: "Update Person",
    formUploadButton: "Upload Photo",
    formRequiredAlert: "Name and relationship are required.",
    pageTitlePlanner: "Daily Activity Planner",
    pageSubtitlePlanner: "Schedule your activities and get timely reminders.",
    activityAddedSuccess: 'Activity "{name}" added.',
    activityUpdatedSuccess: 'Activity "{name}" updated.',
    activityDeletedInfo: "Activity deleted.",
    confirmDeleteActivity: "Are you sure you want to delete this activity?",
    remindSentInfo: 'Reminder for "{name}" sent.',
    ttsAlertMessage: "Text-to-speech not supported. Showing alert instead.",
    activityReminderSpeech: "Reminder: It's time for {name} at {time}. {description}",
    pushNotificationTitle: "Reminder: {name}",
    pushNotificationBody: "Scheduled for {time}",
    addActivityButton: "Add Activity",
    noActivitiesYet: 'No activities scheduled. Click "Add Activity" to plan your day.',
    remindButton: "Remind",
    modalAddActivityTitle: "Add New Activity",
    modalEditActivityTitle: "Edit Activity",
    formActivityNameLabel: "Activity Name",
    formTimeLabel: "Time (HH:MM)",
    formDescriptionLabel: "Description (Optional)",
    formRecurringLabel: "Recurring Activity",
    formAddActivityButton: "Add Activity",
    formUpdateActivityButton: "Update Activity",
    formTimeRequiredAlert: "Activity name and time are required.",
    pageTitleLocation: "Location Services",
    pageSubtitleLocation: "Use the interactive map to find your way.",
    locationRefreshedSuccess: "Current location updated.",
    locationError: "Error getting location: {message}",
    homeSetSuccess: "Home location saved!",
    homeSetSpeech: "Home location has been set.",
    homeSetError: "Could not set home location. Current location unknown.",
    guideHomeError: "Cannot guide home, current location unknown. Try refreshing location.",
    guideHomeNotSetInfo: "Home location is not set. Please set it first.",
    destinationMissingInfo: "Please enter a destination.",
    notifyFamilySuccess: "Simulated: Notifying your family at {emails} that you are leaving.",
    notifyFamilyNoEmails: "No family emails found. Please add contacts in Family Settings to send notifications.",
    currentLocationTitle: "Current Location",
    findingLocation: "Finding your location...",
    latitude: "Latitude",
    longitude: "Longitude",
    refreshLocationButton: "Refresh Location",
    homeSettingsTitle: "Home Settings",
    homeSetLocationInfo: "Home is set to: Lat {lat}, Lon {lon}",
    homeNotSetInfo: 'Home location not set. Go to your home and click "Set Current Location as Home".',
    setHomeButton: "Set Current Location as Home",
    saveLocationButton: "Save This Spot",
    modalSaveLocationTitle: "Save Current Location",
    modalEditLocationTitle: "Edit Location Name",
    formLocationNameLabel: "Location Name",
    formLocationNamePlaceholder: "e.g., Park Entrance, Library",
    formSaveLocationButton: "Save Location",
    formUpdateLocationButton: "Update Name",
    locationNameRequired: "Location name is required.",
    locationSavedSuccess: 'Location "{name}" saved successfully.',
    savedLocationUpdatedSuccess: 'Location "{name}" updated successfully.',
    locationDeletedInfo: "Saved location has been deleted.",
    confirmDeleteLocation: 'Are you sure you want to delete the saved location "{name}"?',
    savedPlacesSectionTitle: "My Saved Places",
    noSavedPlaces: "You haven't saved any places yet. Use the 'Save This Spot' button to add one.",
    guideHereButton: "Guide Me Here",
    navigationHelpTitle: "Route Planner",
    guideHomeButton: "Guide Me Home",
    destinationLabel: "Where do you want to go?",
    destinationPlaceholder: "e.g., Post Office, Doctor's Clinic",
    guideToDestinationButton: "Guide to Destination",
    gettingDirections: "Calculating route...",
    directionsTitle: "Route Steps:",
    readDirectionsButton: "Read Directions",
    safetyActionsTitle: "Safety Actions",
    notifyFamilyButton: "Notify Family",
    notifyFamilyEmailSubject: "Location Update from MemoryCare",
    notifyFamilyEmailBody: "I am sharing my current location.\nLatitude: {lat}\nLongitude: {lon}\n\nView on Google Maps: https://www.google.com/maps?q={lat},{lon}",
    mapError: "Could not load the map. Please check your connection and try again.",
    mapApiKeyError: "Goong API key (GOONG_API_KEY) is not configured. This is different from the Gemini key.",
    geocodeError: "Could not find the location '{destination}'. Please try a different name or address.",
    directionsError: "Could not calculate a route. The destination may be unreachable.",
    pageTitleSettings: "Settings",
    pageSubtitleSettings: "Manage general settings, contacts, and application data.",
    addFamilyEmailButton: "Add Email",
    familyEmailInputPlaceholder: "Family member's email",
    noFamilyEmails: "No family members have been added yet.",
    familyEmailAddedSuccess: "{email} has been added to your family list.",
    familyEmailExistsError: "{email} is already in the list.",
    familyEmailInvalidError: "Please enter a valid email address.",
    familyEmailDeletedInfo: "{email} has been removed from the list.",
    confirmDeleteEmail: "Are you sure you want to remove {email}?",
    sharePlanButton: "Share Plan",
    sharePlanSuccess: "Simulated: Today's plan has been sent to {emails}.",
    sharePlanNoEmails: "No family emails found. Please add contacts in Family Settings to share your plan.",
    sharePlanEmailSubject: "Daily Plan from MemoryCare",
    sharePlanEmailBodyHeader: "Here is the schedule for today:\n\n",
    familyContactsSectionTitle: "Family Contacts",
    dataManagementTitle: "Data Management",
    dataManagementSubtitle: "Backup your data to a file or restore it from a backup.",
    exportDataButton: "Export Data",
    importDataButton: "Import Data",
    importConfirmTitle: "Confirm Import",
    importConfirmMessage: "Choose how to import the data. 'Merge' will add new items and update existing ones from the file. 'Overwrite' will delete all current data and replace it with the backup.",
    mergeDataButton: "Merge Data",
    overwriteDataButton: "Overwrite All Data",
    importSuccessMerge: "Data merged successfully! The app will now reload.",
    importSuccessOverwrite: "Data overwritten successfully! The app will now reload.",
    importErrorInvalidFile: "Import failed. The selected file is not a valid MemoryCare backup file.",
    importErrorReadFile: "Import failed. Could not read the selected file.",
    aiWelcomeMessage: "Hello! I'm your friendly assistant. How can I help you remember something today?",
    aiPlaceholder: "Ask me a question...",
    pageTitleMyStory: "My Story",
    pageSubtitleMyStory: "A living story of your life, updated with each memory you share.",
    myStoryAIQuestionTitle: "A Question for Today",
    myStoryYourAnswerTitle: "Your Answer",
    myStoryAnswerPlaceholder: "Share your thoughts and memories here...",
    myStorySaveAndUpdateButton: "Update My Story",
    myStoryTitle: "My Life Story",
    myStoryInitialStory: "Your story will be written here as you answer the questions. Let's begin by answering the first question.",
    myStoryLoadingStory: "Weaving your memories into a beautiful story...",
    myStoryLoadingQuestion: "Thinking of a new question for you...",
    myStoryMicrophoneButtonStart: "Record Answer",
    myStoryMicrophoneButtonStop: "Stop Recording",
    notificationPermissionBannerTitle: "Enable Notifications",
    notificationPermissionBannerBody: "Get timely reminders for your scheduled activities, even when the app is in the background.",
    locationPermissionBannerTitle: "Enable Location Services",
    locationPermissionBannerBody: "To provide navigation and map features, this app needs to access your device's location.",
    enableButton: "Enable",
    notNowButton: "Not Now",
    locationPermissionDeniedTitle: "Location Access Denied",
    locationPermissionDeniedBody: "To use map features, please enable location permissions for this site in your browser settings.",
    locationRequiredForMap: "Location access is required for map features.",
    enableLocationToBegin: "Please enable location to begin.",
  },
  vi: {
    headerTitle: "MemoryCare",
    navHome: "Trang Chá»§",
    navMemoryLog: "Nháº­t KÃ½",
    navPlanner: "Káº¿ hoáº¡ch",
    navLocation: "Vá» TrÃ­",
    navMyStory: "CÃ¢u Chuyá»n Cá»§a TÃ´i",
    navSettings: "CÃ i Äáº·t",
    footerText: "MemoryCare Â© {year}",
    language: "NgÃ´n ngá»¯",
    welcomeTitle: "Tá»ng quan hÃ´m nay",
    welcomeSubtitle: "ÄÃ¢y lÃ  cÃ¡c hoáº¡t Äá»ng trong ngÃ y cá»§a báº¡n.",
    welcomeMessage: "á»¨ng dá»¥ng nÃ y sáº½ giÃºp báº¡n sáº¯p xáº¿p cÃ´ng viá»c hÃ ng ngÃ y, ghi nhá» nhá»¯ng Äiá»u quan trá»ng vÃ  luÃ´n káº¿t ná»i vá»i ngÆ°á»i thÃ¢n.",
    todaysSchedule: "Lá»ch trÃ¬nh hÃ´m nay",
    noActivitiesToday: "HÃ´m nay chÆ°a cÃ³ hoáº¡t Äá»ng nÃ o. Báº¡n cÃ³ muá»n báº¯t Äáº§u láº­p káº¿ hoáº¡ch khÃ´ng?",
    goToPlanner: "Tá»i trang Káº¿ hoáº¡ch",
    familiarFace: "GÆ°Æ¡ng máº·t thÃ¢n quen",
    noPeopleToAdd: "ChÆ°a cÃ³ ai trong danh báº¡. Báº¡n hÃ£y thÃªm ngÆ°á»i thÃ¢n Äá» báº¯t Äáº§u.",
    goToMemoryLog: "Tá»i trang Nháº­t kÃ½",
    quickActions: "TÃ¡c vá»¥ nhanh",
    featureMemoryLogTitle: "Nháº­t kÃ½ Ká»· niá»m",
    featureMemoryLogDesc: "LÆ°u giá»¯ thÃ´ng tin vá» ngÆ°á»i thÃ¢n vÃ  nhá»¯ng suy nghÄ© hÃ ng ngÃ y.",
    featurePlannerTitle: "Láº­p Káº¿ hoáº¡ch",
    featurePlannerDesc: "LÃªn káº¿ hoáº¡ch cho cÃ¡c hoáº¡t Äá»ng vÃ  nháº­n lá»i nháº¯c.",
    featureLocationTitle: "Dá»ch vá»¥ Vá» trÃ­",
    featureLocationDesc: "Há» trá»£ tÃ¬m ÄÆ°á»ng vÃ  giá»¯ an toÃ n cho báº¡n.",
    reminderTitle: "Lá»i nháº¯n gá»­i yÃªu thÆ°Æ¡ng",
    reminderText: "Má»i ngÃ y Äá»u lÃ  má»t hÃ nh trÃ¬nh má»i. LuÃ´n cÃ³ chÃºng tÃ´i á» ÄÃ¢y Äá»ng hÃ nh cÃ¹ng báº¡n. Khi cáº§n trá»£ giÃºp, Äá»«ng ngáº§n ngáº¡i liÃªn há» vá»i ngÆ°á»i chÄm sÃ³c hoáº·c ngÆ°á»i thÃ¢n cá»§a báº¡n.",
    pageTitleMemoryLog: "Nháº­t kÃ½ Ká»· niá»m",
    pageSubtitleMemoryLog: "LÆ°u giá»¯ ká»· niá»m vá» nhá»¯ng ngÆ°á»i thÃ¢n yÃªu vÃ  ghi láº¡i nháº­t kÃ½ má»i ngÃ y.",
    personAddedSuccess: "ÄÃ£ thÃªm {name} thÃ nh cÃ´ng!",
    personUpdatedSuccess: "ÄÃ£ cáº­p nháº­t {name} thÃ nh cÃ´ng.",
    personDeletedInfo: "ÄÃ£ xÃ³a thÃ´ng tin cá»§a ngÆ°á»i nÃ y.",
    confirmDeletePerson: "Báº¡n cÃ³ cháº¯c muá»n xÃ³a ngÆ°á»i nÃ y khÃ´ng?",
    journalSavedSuccess: "ÄÃ£ lÆ°u ghi chÃº thÃ nh cÃ´ng!",
    journalNoSpeechInfo: "KhÃ´ng nháº­n dáº¡ng ÄÆ°á»£c giá»ng nÃ³i. Vui lÃ²ng thá»­ láº¡i.",
    confirmDeleteJournal: "Báº¡n cÃ³ cháº¯c muá»n xÃ³a ghi chÃº nÃ y khÃ´ng?",
    journalDeletedInfo: "ÄÃ£ xÃ³a ghi chÃº.",
    ttsNotSupportedError: "TÃ­nh nÄng Äá»c khÃ´ng ÄÆ°á»£c há» trá»£ trÃªn thiáº¿t bá» nÃ y.",
    ttsLanguageUnavailableError: "KhÃ´ng tÃ¬m tháº¥y giá»ng Äá»c tiáº¿ng Viá»t trÃªn thiáº¿t bá». TÃ­nh nÄng Äá»c sáº½ khÃ´ng hoáº¡t Äá»ng.",
    peopleSectionTitle: "NgÆ°á»i thÃ¢n",
    addPersonButton: "ThÃªm NgÆ°á»i thÃ¢n",
    noPeopleYet: 'ChÆ°a cÃ³ ai ÄÆ°á»£c thÃªm. HÃ£y báº¥m "ThÃªm NgÆ°á»i thÃ¢n" Äá» báº¯t Äáº§u.',
    recallButton: "Gá»£i Nhá»",
    editButton: "Sá»­a",
    deleteButton: "XÃ³a",
    personRecallSpeech: "ÄÃ¢y lÃ  {name}, lÃ  {relationship} cá»§a báº¡n. {keyInfo}",
    journalSectionTitle: "Ghi chÃº hÃ ng ngÃ y",
    journalDescription: "DÃ¹ng giá»ng nÃ³i Äá» ghi láº¡i nhá»¯ng suy nghÄ©, cáº£m xÃºc hay hoáº¡t Äá»ng trong ngÃ y cá»§a báº¡n.",
    speechNotSupported: "TrÃ¬nh duyá»t cá»§a báº¡n khÃ´ng há» trá»£ nháº­n dáº¡ng giá»ng nÃ³i.",
    listeningPlaceholder: "TÃ´i Äang nghe...",
    recordedThoughtsPlaceholder: "Nhá»¯ng gÃ¬ báº¡n nÃ³i sáº½ ÄÆ°á»£c ghi láº¡i á» ÄÃ¢y...",
    startRecordingButton: "Báº¯t Äáº§u ghi Ã¢m",
    stopRecordingButton: "Dá»«ng ghi Ã¢m",
    saveEntryButton: "LÆ°u Ghi chÃº",
    pastEntriesTitle: "CÃ¡c ghi chÃº trÆ°á»c ÄÃ¢y:",
    readAloudButton: "Äá»c to",
    modalAddPersonTitle: "ThÃªm ngÆ°á»i thÃ¢n má»i",
    modalEditPersonTitle: "Sá»­a thÃ´ng tin {name}",
    formNameLabel: "TÃªn",
    formRelationshipLabel: "Má»i quan há»",
    formPhotoUrlLabel: "URL áº¢nh hoáº·c Táº£i lÃªn",
    formKeyInfoLabel: "ThÃ´ng tin gá»£i nhá»",
    formCancelButton: "Há»§y",
    formAddButton: "ThÃªm",
    formUpdateButton: "Cáº­p nháº­t",
    formUploadButton: "Táº£i áº£nh",
    formRequiredAlert: "TÃªn vÃ  má»i quan há» lÃ  báº¯t buá»c.",
    pageTitlePlanner: "Káº¿ hoáº¡ch trong ngÃ y",
    pageSubtitlePlanner: "LÃªn lá»ch cho cÃ¡c hoáº¡t Äá»ng vÃ  nháº­n lá»i nháº¯c ÄÃºng giá».",
    activityAddedSuccess: 'ÄÃ£ thÃªm hoáº¡t Äá»ng "{name}".',
    activityUpdatedSuccess: 'ÄÃ£ cáº­p nháº­t hoáº¡t Äá»ng "{name}".',
    activityDeletedInfo: "ÄÃ£ xÃ³a hoáº¡t Äá»ng.",
    confirmDeleteActivity: "Báº¡n cÃ³ cháº¯c muá»n xÃ³a hoáº¡t Äá»ng nÃ y khÃ´ng?",
    remindSentInfo: 'ÄÃ£ gá»­i lá»i nháº¯c vá» hoáº¡t Äá»ng "{name}".',
    ttsAlertMessage: "TÃ­nh nÄng Äá»c khÃ´ng ÄÆ°á»£c há» trá»£. Sáº½ hiá»n thá» thÃ´ng bÃ¡o thay tháº¿.",
    activityReminderSpeech: "Nháº¯c nhá»: ÄÃ£ Äáº¿n giá» {name} lÃºc {time}. {description}",
    pushNotificationTitle: "Nháº¯c nhá»: {name}",
    pushNotificationBody: "Lá»ch trÃ¬nh lÃºc {time}",
    addActivityButton: "ThÃªm hoáº¡t Äá»ng",
    noActivitiesYet: 'ChÆ°a cÃ³ hoáº¡t Äá»ng nÃ o ÄÆ°á»£c lÃªn lá»ch. HÃ£y báº¥m "ThÃªm hoáº¡t Äá»ng" Äá» báº¯t Äáº§u.',
    remindButton: "Nháº¯c nhá»",
    modalAddActivityTitle: "ThÃªm hoáº¡t Äá»ng má»i",
    modalEditActivityTitle: "Sá»­a hoáº¡t Äá»ng",
    formActivityNameLabel: "TÃªn hoáº¡t Äá»ng",
    formTimeLabel: "Thá»i gian (Giá»:PhÃºt)",
    formDescriptionLabel: "MÃ´ táº£ (khÃ´ng báº¯t buá»c)",
    formRecurringLabel: "Hoáº¡t Äá»ng láº·p láº¡i",
    formAddActivityButton: "ThÃªm",
    formUpdateActivityButton: "Cáº­p nháº­t",
    formTimeRequiredAlert: "TÃªn hoáº¡t Äá»ng vÃ  thá»i gian lÃ  báº¯t buá»c.",
    pageTitleLocation: "Äá»nh vá» & TÃ¬m ÄÆ°á»ng",
    pageSubtitleLocation: "DÃ¹ng báº£n Äá» Äá» tÃ¬m ÄÆ°á»ng Äi dá» dÃ ng hÆ¡n.",
    locationRefreshedSuccess: "ÄÃ£ cáº­p nháº­t vá» trÃ­ hiá»n táº¡i.",
    locationError: "KhÃ´ng thá» láº¥y vá» trÃ­: {message}",
    homeSetSuccess: "ÄÃ£ lÆ°u vá» trÃ­ nhÃ !",
    homeSetSpeech: "Vá» trÃ­ nhÃ  ÄÃ£ ÄÆ°á»£c lÆ°u.",
    homeSetError: "KhÃ´ng thá» lÆ°u vá» trÃ­ nhÃ  vÃ¬ chÆ°a cÃ³ vá» trÃ­ hiá»n táº¡i cá»§a báº¡n.",
    guideHomeError: "KhÃ´ng thá» chá» ÄÆ°á»ng vá» nhÃ  vÃ¬ chÆ°a biáº¿t vá» trÃ­ hiá»n táº¡i. Báº¡n hÃ£y thá»­ lÃ m má»i láº¡i vá» trÃ­.",
    guideHomeNotSetInfo: "Báº¡n chÆ°a lÆ°u vá» trÃ­ nhÃ . Vui lÃ²ng lÆ°u láº¡i Äá» dÃ¹ng tÃ­nh nÄng nÃ y.",
    destinationMissingInfo: "Vui lÃ²ng nháº­p Äiá»m Äáº¿n cá»§a báº¡n.",
    notifyFamilySuccess: "ÄÃ£ chuáº©n bá» email Äá» gá»­i thÃ´ng bÃ¡o cho ngÆ°á»i thÃ¢n táº¡i {emails}.",
    notifyFamilyNoEmails: "ChÆ°a cÃ³ email ngÆ°á»i thÃ¢n. Vui lÃ²ng vÃ o CÃ i Äáº·t Äá» thÃªm.",
    currentLocationTitle: "Vá» trÃ­ hiá»n táº¡i",
    findingLocation: "Äang tÃ¬m vá» trÃ­ cá»§a báº¡n...",
    latitude: "VÄ© Äá»",
    longitude: "Kinh Äá»",
    refreshLocationButton: "Táº£i láº¡i vá» trÃ­",
    homeSettingsTitle: "Vá» trÃ­ nhÃ ",
    homeSetLocationInfo: "Vá» trÃ­ nhÃ : VÄ© Äá» {lat}, Kinh Äá» {lon}",
    homeNotSetInfo: 'Vá» trÃ­ nhÃ  chÆ°a ÄÆ°á»£c Äáº·t. HÃ£y Äáº¿n nhÃ  vÃ  báº¥m nÃºt "Äáº·t vá» trÃ­ hiá»n táº¡i lÃ m nhÃ ".',
    setHomeButton: "Äáº·t vá» trÃ­ hiá»n táº¡i lÃ m nhÃ ",
    saveLocationButton: "LÆ°u Äá»a Äiá»m nÃ y",
    modalSaveLocationTitle: "LÆ°u vá» trÃ­ hiá»n táº¡i",
    modalEditLocationTitle: "Sá»­a tÃªn vá» trÃ­",
    formLocationNameLabel: "TÃªn vá» trÃ­",
    formLocationNamePlaceholder: "vÃ­ dá»¥: Lá»i vÃ o cÃ´ng viÃªn, ThÆ° viá»n",
    formSaveLocationButton: "LÆ°u vá» trÃ­",
    formUpdateLocationButton: "Cáº­p nháº­t tÃªn",
    locationNameRequired: "Báº¡n cáº§n nháº­p tÃªn vá» trÃ­.",
    locationSavedSuccess: 'ÄÃ£ lÆ°u vá» trÃ­ "{name}" thÃ nh cÃ´ng.',
    savedLocationUpdatedSuccess: 'ÄÃ£ cáº­p nháº­t vá» trÃ­ "{name}" thÃ nh cÃ´ng.',
    locationDeletedInfo: "ÄÃ£ xÃ³a vá» trÃ­ ÄÃ£ lÆ°u.",
    confirmDeleteLocation: 'Báº¡n cÃ³ cháº¯c muá»n xÃ³a vá» trÃ­ ÄÃ£ lÆ°u "{name}" khÃ´ng?',
    savedPlacesSectionTitle: "Äá»a Äiá»m ÄÃ£ LÆ°u",
    noSavedPlaces: "Báº¡n chÆ°a lÆ°u Äá»a Äiá»m nÃ o. HÃ£y dÃ¹ng nÃºt 'LÆ°u Äá»a Äiá»m nÃ y' Äá» thÃªm.",
    guideHereButton: "Chá» ÄÆ°á»ng Äáº¿n ÄÃ¢y",
    navigationHelpTitle: "TÃ¬m ÄÆ°á»ng Äi",
    guideHomeButton: "Chá» ÄÆ°á»ng vá» nhÃ ",
    destinationLabel: "Báº¡n muá»n Äi ÄÃ¢u?",
    destinationPlaceholder: "vÃ­ dá»¥: BÆ°u Äiá»n, PhÃ²ng khÃ¡m bÃ¡c sÄ©",
    guideToDestinationButton: "TÃ¬m ÄÆ°á»ng",
    gettingDirections: "Äang tÃ¬m ÄÆ°á»ng...",
    directionsTitle: "Chá» dáº«n ÄÆ°á»ng Äi:",
    readDirectionsButton: "Äá»c chá» ÄÆ°á»ng",
    safetyActionsTitle: "Há» trá»£ an toÃ n",
    notifyFamilyButton: "BÃ¡o cho ngÆ°á»i thÃ¢n",
    notifyFamilyEmailSubject: "Cáº­p Nháº­t Vá» TrÃ­ tá»« MemoryCare",
    notifyFamilyEmailBody: "TÃ´i Äang chia sáº» vá» trÃ­ hiá»n táº¡i cá»§a mÃ¬nh.\nVÄ© Äá»: {lat}\nKinh Äá»: {lon}\n\nXem trÃªn Google Maps: https://www.google.com/maps?q={lat},{lon}",
    mapError: "KhÃ´ng táº£i ÄÆ°á»£c báº£n Äá». Báº¡n vui lÃ²ng kiá»m tra láº¡i káº¿t ná»i máº¡ng.",
    mapApiKeyError: "KhÃ³a API Goong (GOONG_API_KEY) chÆ°a ÄÆ°á»£c cáº¥u hÃ¬nh. KhÃ³a nÃ y khÃ¡c vá»i khÃ³a Gemini.",
    geocodeError: "KhÃ´ng tÃ¬m tháº¥y Äá»a Äiá»m '{destination}'. Vui lÃ²ng thá»­ má»t tÃªn hoáº·c Äá»a chá» khÃ¡c.",
    directionsError: "KhÃ´ng thá» tÃ¬m ÄÆ°á»£c ÄÆ°á»ng Äi. Äiá»m Äáº¿n cÃ³ thá» khÃ´ng tá»n táº¡i hoáº·c khÃ´ng thá» Äi tá»i.",
    pageTitleSettings: "CÃ i Äáº·t",
    pageSubtitleSettings: "Quáº£n lÃ½ cÃ i Äáº·t chung, danh báº¡ ngÆ°á»i thÃ¢n vÃ  dá»¯ liá»u.",
    addFamilyEmailButton: "ThÃªm",
    familyEmailInputPlaceholder: "Email cá»§a ngÆ°á»i thÃ¢n",
    noFamilyEmails: "ChÆ°a cÃ³ email ngÆ°á»i thÃ¢n nÃ o.",
    familyEmailAddedSuccess: "ÄÃ£ thÃªm {email} vÃ o danh sÃ¡ch ngÆ°á»i thÃ¢n.",
    familyEmailExistsError: "{email} ÄÃ£ cÃ³ trong danh sÃ¡ch.",
    familyEmailInvalidError: "Äá»a chá» email khÃ´ng há»£p lá». Báº¡n vui lÃ²ng kiá»m tra láº¡i.",
    familyEmailDeletedInfo: "ÄÃ£ xÃ³a {email} khá»i danh sÃ¡ch.",
    confirmDeleteEmail: "Báº¡n cÃ³ cháº¯c muá»n xÃ³a {email} khÃ´ng?",
    sharePlanButton: "Chia sáº» lá»ch trÃ¬nh",
    sharePlanSuccess: "Lá»ch trÃ¬nh hÃ´m nay ÄÃ£ sáºµn sÃ ng Äá» gá»­i tá»i {emails}.",
    sharePlanNoEmails: "ChÆ°a cÃ³ email ngÆ°á»i thÃ¢n. Vui lÃ²ng vÃ o CÃ i Äáº·t Äá» thÃªm liÃªn há» vÃ  chia sáº» lá»ch trÃ¬nh.",
    sharePlanEmailSubject: "Lá»ch trÃ¬nh hÃ ng ngÃ y tá»« MemoryCare",
    sharePlanEmailBodyHeader: "ÄÃ¢y lÃ  lá»ch trÃ¬nh cho hÃ´m nay:\n\n",
    familyContactsSectionTitle: "Danh báº¡ ngÆ°á»i thÃ¢n",
    dataManagementTitle: "Quáº£n lÃ½ Dá»¯ liá»u",
    dataManagementSubtitle: "Sao lÆ°u dá»¯ liá»u cá»§a báº¡n ra tá»p hoáº·c khÃ´i phá»¥c láº¡i tá»« báº£n sao lÆ°u.",
    exportDataButton: "Sao lÆ°u Dá»¯ liá»u",
    importDataButton: "Phá»¥c há»i Dá»¯ liá»u",
    importConfirmTitle: "XÃ¡c nháº­n Phá»¥c há»i",
    importConfirmMessage: "Báº¡n muá»n phá»¥c há»i dá»¯ liá»u theo cÃ¡ch nÃ o? 'Há»£p nháº¥t' sáº½ thÃªm cÃ¡c má»¥c má»i vÃ  cáº­p nháº­t cÃ¡c má»¥c hiá»n cÃ³ tá»« tá»p. 'Ghi ÄÃ¨' sáº½ xÃ³a táº¥t cáº£ dá»¯ liá»u hiá»n táº¡i vÃ  thay tháº¿ báº±ng báº£n sao lÆ°u.",
    mergeDataButton: "Há»£p nháº¥t",
    overwriteDataButton: "Ghi ÄÃ¨",
    importSuccessMerge: "ÄÃ£ há»£p nháº¥t dá»¯ liá»u thÃ nh cÃ´ng! á»¨ng dá»¥ng sáº½ khá»i Äá»ng láº¡i.",
    importSuccessOverwrite: "ÄÃ£ phá»¥c há»i dá»¯ liá»u thÃ nh cÃ´ng! á»¨ng dá»¥ng sáº½ khá»i Äá»ng láº¡i.",
    importErrorInvalidFile: "Phá»¥c há»i tháº¥t báº¡i. Tá»p báº¡n chá»n khÃ´ng pháº£i lÃ  tá»p sao lÆ°u há»£p lá» cá»§a MemoryCare.",
    importErrorReadFile: "Phá»¥c há»i tháº¥t báº¡i. KhÃ´ng thá» Äá»c ÄÆ°á»£c tá»p báº¡n ÄÃ£ chá»n.",
    aiWelcomeMessage: "Xin chÃ o, tÃ´i lÃ  trá»£ lÃ½ áº£o cá»§a báº¡n ÄÃ¢y. HÃ´m nay, báº¡n muá»n tÃ´i giÃºp gá»£i nhá» vá» Äiá»u gÃ¬ nÃ o?",
    aiPlaceholder: "Há»i tÃ´i báº¥t cá»© Äiá»u gÃ¬...",
    pageTitleMyStory: "CÃ¢u Chuyá»n Cá»§a TÃ´i",
    pageSubtitleMyStory: "Cuá»n tá»± truyá»n vá» cuá»c Äá»i báº¡n, ÄÆ°á»£c vun Äáº¯p tá»« nhá»¯ng kÃ½ á»©c báº¡n chia sáº» má»i ngÃ y.",
    myStoryAIQuestionTitle: "Gá»£i Ã½ cho hÃ´m nay",
    myStoryYourAnswerTitle: "Há»i á»©c cá»§a báº¡n",
    myStoryAnswerPlaceholder: "HÃ£y chia sáº» nhá»¯ng dÃ²ng suy nghÄ© vÃ  kÃ½ á»©c cá»§a báº¡n á» ÄÃ¢y...",
    myStorySaveAndUpdateButton: "Cáº­p nháº­t cÃ¢u chuyá»n",
    myStoryTitle: "CÃ¢u Chuyá»n Cuá»c Äá»i TÃ´i",
    myStoryInitialStory: "CÃ¢u chuyá»n cá»§a báº¡n sáº½ ÄÆ°á»£c viáº¿t nÃªn tá»« nhá»¯ng cÃ¢u tráº£ lá»i. HÃ£y báº¯t Äáº§u vá»i cÃ¢u há»i Äáº§u tiÃªn.",
    myStoryLoadingStory: "Äang dá»t nÃªn cÃ¢u chuyá»n tuyá»t Äáº¹p tá»« kÃ½ á»©c cá»§a báº¡n...",
    myStoryLoadingQuestion: "Äang nghÄ© cÃ¢u há»i tiáº¿p theo cho báº¡n...",
    myStoryMicrophoneButtonStart: "Ghi Ã¢m cÃ¢u tráº£ lá»i",
    myStoryMicrophoneButtonStop: "Dá»«ng ghi Ã¢m",
    notificationPermissionBannerTitle: "Báº­t thÃ´ng bÃ¡o",
    notificationPermissionBannerBody: "Nháº­n lá»i nháº¯c ká»p thá»i cho cÃ¡c hoáº¡t Äá»ng ÄÃ£ lÃªn lá»ch, ngay cáº£ khi á»©ng dá»¥ng cháº¡y ná»n.",
    locationPermissionBannerTitle: "Báº­t Dá»ch vá»¥ Vá» trÃ­",
    locationPermissionBannerBody: "Äá» cung cáº¥p tÃ­nh nÄng báº£n Äá» vÃ  chá» ÄÆ°á»ng, á»©ng dá»¥ng cáº§n truy cáº­p vá» trÃ­ thiáº¿t bá» cá»§a báº¡n.",
    enableButton: "Báº­t",
    notNowButton: "Äá» sau",
    locationPermissionDeniedTitle: "Truy cáº­p vá» trÃ­ bá» tá»« chá»i",
    locationPermissionDeniedBody: "Äá» sá»­ dá»¥ng cÃ¡c tÃ­nh nÄng báº£n Äá», vui lÃ²ng báº­t quyá»n truy cáº­p vá» trÃ­ cho trang web nÃ y trong cÃ i Äáº·t trÃ¬nh duyá»t cá»§a báº¡n.",
    locationRequiredForMap: "Cáº§n truy cáº­p vá» trÃ­ Äá» sá»­ dá»¥ng tÃ­nh nÄng báº£n Äá».",
    enableLocationToBegin: "Vui lÃ²ng báº­t vá» trÃ­ Äá» báº¯t Äáº§u.",
  }
};

const LanguageContext = createContext<LanguageContextType | undefined>(undefined);

export const LanguageProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [language, setLanguage] = useLocalStorage<Language>('language', 'vi');

  const t = useCallback((key: keyof typeof translations['en'], ...args: (string | number)[]) => {
    let translation = translations[language]?.[key] || translations['en'][key];
    
    // Sequentially replace placeholders to avoid issues with global regex state
    args.forEach(arg => {
        translation = translation.replace(/\{[^{}]+\}/, String(arg));
    });

    return translation;
  }, [language]);


  return (
    <LanguageContext.Provider value={{ language, setLanguage, t }}>
      {children}
    </LanguageContext.Provider>
  );
};

export const useTranslation = () => {
  const context = useContext(LanguageContext);
  if (context === undefined) {
    throw new Error('useTranslation must be used within a LanguageProvider');
  }
  return context;
};
